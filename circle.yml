machine:
  timezone:
    Asia/Tokyo
  php:
    version: 5.6.5
  environment:
    APP_ENV: circleci
    DB_HOST: 127.0.0.1
    DB_DATABASE: homestead
    DB_USERNAME: homestead
    DB_PASSWORD: secret

#dependencies:
#  override:
#    - cp Code/composer.json_org Code/composer.json
#    - cd Code && composer install --prefer-source --no-interaction --no-dev
  post:
    - sudo chmod -R 775 Code/storage
    - sudo chmod -R 775 Code/bootstrap/cache

#database:
#  override:
#    - cd Code && php artisan migrate --force --env=circleci
#    - cd Code && php artisan db:seed --force --env=circleci

test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/phpunit
    - cd Code && phpunit --log-junit $CIRCLE_TEST_REPORTS/phpunit/junit.xml tests
  post:
    - Code/vendor/bin/phpunit -c Code/phpunit.xml
